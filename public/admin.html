<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GalÃ¡pagos Admin</title>
<style>
body {
  background: radial-gradient(circle at top, #0f3d2e, #000);
  color: #eafff7;
  font-family: Arial;
  padding: 40px;
}
h1 { color: #00ff9c; }
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  padding: 12px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
tr:hover { background: rgba(0,255,156,0.05); }
button {
  padding: 6px 10px;
  margin-right: 5px;
}
.badge-ok { color:#00ff9c }
.badge-used { color:#ff4d4d }
</style>
</head>

<body>

<h1>ðŸŒ± GalÃ¡pagos Admin</h1>

<h2>Crear Producto</h2>
<input id="productName" placeholder="Nombre"><br>
<input id="price" type="number" placeholder="Precio USD"><br>
<input id="units" type="number" placeholder="Unidades"><br>
<input id="adminToken" type="password" placeholder="Admin token"><br>
<button onclick="create()">Crear</button>

<h2>Productos</h2>
<table>
<thead>
<tr><th>Nombre</th><th>Precio</th><th>QRs</th><th>Reclamados</th><th>Acciones</th></tr>
</thead>
<tbody id="products"></tbody>
</table>

<h2 id="qrTitle"></h2>
<ul id="qrList"></ul>

<script>
async function create() {
  await fetch("/admin/create-product", {
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "x-admin-token":adminToken.value
    },
    body:JSON.stringify({
      name:productName.value,
      value:Number(price.value),
      units:Number(units.value)
    })
  });
  load();
}

async function load() {
  const r = await fetch("/admin/products");
  const products = await r.json();
  productsEl.innerHTML = "";
  products.forEach(p=>{
    productsEl.innerHTML += `
      <tr>
        <td>${p.name}</td>
        <td>$${p.price_usd}</td>
        <td>${p.total_qrs}</td>
        <td>${p.claimed_qrs}</td>
        <td>
          <button onclick="view('${p.id}','${p.name}')">Ver</button>
          <button onclick="zip('${p.id}')">ZIP</button>
          <button onclick="zip('${p.id}',true)">ZIP nuevos</button>
        </td>
      </tr>`;
  });
}

async function view(id,name) {
  const r = await fetch(`/admin/products/${id}/qrs`);
  const qrs = await r.json();
  qrTitle.textContent = `QRs de ${name}`;
  qrList.innerHTML = "";
  qrs.forEach(q=>{
    qrList.innerHTML += `<li>${q.id} ${
      q.claimed ? "<span class='badge-used'>reclamado</span>"
                : "<span class='badge-ok'>disponible</span>"
    }</li>`;
  });
}

function zip(id,only=false){
  window.open(`/admin/products/${id}/qrs.zip${only?"?only=new":""}`);
}

load();
</script>

</body>
</html>
