<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GalÃ¡pagos Admin</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#041c16;--card:#063126;--neon:#00ffb3;--muted:#8fdcc5;--text:#eafff7;
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:radial-gradient(circle at top,var(--card),var(--bg));color:var(--text)}
header{padding:20px 28px;display:flex;justify-content:space-between;align-items:center}
h1{color:var(--neon)}
.wrap{padding:20px 28px;display:grid;gap:20px}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px}
.stat{background:linear-gradient(180deg,#084235,#05251d);border-radius:16px;padding:16px}
.stat small{color:var(--muted)} .stat b{font-size:26px;color:var(--neon)}
.card{background:linear-gradient(180deg,#084235,#05251d);border-radius:18px;padding:18px}
.form{display:grid;gap:10px}
input,button{border:none;border-radius:10px;padding:12px}
input{background:#031a14;color:var(--text)}
button{background:linear-gradient(90deg,var(--neon),#00c98e);font-weight:700}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #0a4a3a}
th{color:var(--muted);font-size:13px}
.actions button{padding:6px 10px;font-size:12px}
</style>
</head>
<body>

<header>
  <h1>ðŸŒ± GalÃ¡pagos Admin</h1>
  <span style="color:var(--muted)">Solana</span>
</header>

<div class="wrap">

  <div class="stats">
    <div class="stat"><small>Productos</small><b id="sProd">â€“</b></div>
    <div class="stat"><small>QRs</small><b id="sQr">â€“</b></div>
    <div class="stat"><small>Reclamados</small><b id="sClaim">â€“</b></div>
  </div>

  <div class="card">
    <h3>Crear producto</h3>
    <div class="form">
      <input id="name" placeholder="Nombre">
      <input id="price" type="number" step="0.01" placeholder="Precio USD">
      <input id="units" type="number" placeholder="Cantidad (QRs)">
      <input id="token" type="password" placeholder="Admin token">
      <button onclick="create()">Crear</button>
    </div>
  </div>

  <div class="card">
    <h3>Productos</h3>
    <table>
      <thead>
        <tr><th>Nombre</th><th>Precio</th><th>QRs</th><th>Acciones</th></tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

</div>

<script>
async function load(){
  const r = await fetch("/admin/products");
  const d = await r.json();

  let q=0,c=0;
  rows.innerHTML="";
  d.forEach(p=>{
    q+=Number(p.units);
    c+=Number(p.claimed);
    rows.innerHTML+=`
      <tr>
        <td>${p.name}</td>
        <td>$${p.price_usd}</td>
        <td>${p.claimed}/${p.units}</td>
        <td class="actions">
          <button onclick="zip('${p.id}')">ZIP</button>
        </td>
      </tr>`;
  });

  sProd.textContent=d.length;
  sQr.textContent=q;
  sClaim.textContent=c;
}

async function create(){
  const res = await fetch("/admin/create-product",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      name:name.value,
      price_usd:Number(price.value),
      units:Number(units.value),
      admin_token:token.value
    })
  });
  const j = await res.json();
  if(!res.ok) alert(JSON.stringify(j));
  load();
}

function zip(id){ window.location=`/admin/download-zip/${id}` }

load();
</script>
</body>
</html>
